var formElement=null;var xmlDoc=null;var question;var questions=0;var numOpt=0;var opcionesArray=[];var intI=0;var selPos=0;var boxPos=0;var nota=0.0;var contQues=0;var answerXml=null;var answerUser=null;var xPath="";var nodo=null;var conTenedor=null;var contY=0;window.onload=function(){formElement=document.getElementById("myform");formElement.onsubmit=function(){if(coprobarPreguntas()){corregirTipoText();corregirTiposSelect();corregirTiposRadio();corregirTiposCheckbox();corregirTiposSelMultiple();mostrarNota();} return false;} var xhttp=new XMLHttpRequest();xhttp.onreadystatechange=function(){if(this.readyState==4&&this.status==200){gestionarXml(this);}};xhttp.open("GET","https://rawgit.com/LBarry97/ProyectoHistoria/master/xml/historia.xml",true);xhttp.send();document.getElementById("refres").onclick=function(){formElement.reset();location.reload();document.getElementById("refres").style.display="none";document.getElementById("sub").style.display="block";}} function gestionarXml(dadesXml){xmlDoc=dadesXml.responseXML;leerYpintar();} function leerYpintar(){questions=10;for(i=0;i<questions;i++){if(i==0||i==1){question=xmlDoc.getElementsByTagName("title")[i].innerHTML;document.getElementsByTagName("h3")[i].innerHTML=question;} if(i==2||i==3){question=xmlDoc.getElementsByTagName("title")[i].innerHTML;document.getElementsByTagName("h3")[i].innerHTML=question;if(i==2){xPath="/questions/question[@id='jklm_003']/option";}else{xPath="/questions/question[@id='jklm_004']/option";} nodo=xmlDoc.evaluate(xPath,xmlDoc,null,XPathResult.ANY_TYPE,null);var select=document.getElementsByTagName("select")[selPos];contY=0;while(conTenedor=nodo.iterateNext()){var option=document.createElement("option");option.text=conTenedor.innerHTML;option.value=contY+1;contY++;select.options.add(option);} selPos++;} if(i==4||i==5){question=xmlDoc.getElementsByTagName("title")[i].innerHTML;document.getElementsByTagName("h3")[i].innerHTML=question;if(i==4){xPath="/questions/question[@id='jklm_005']/option";}else{xPath="/questions/question[@id='jklm_006']/option";} nodo=xmlDoc.evaluate(xPath,xmlDoc,null,XPathResult.ANY_TYPE,null);var div=document.getElementsByTagName("div")[boxPos] contY=0;while(conTenedor=nodo.iterateNext()){var input=document.createElement("input");var label=document.createElement("label");var espacio1=document.createElement("br");var espacio2=document.createElement("br");input.type="radio";if(i==4){input.name="radio1";input.id="radio1_"+contY;label.setAttribute("for","radio1_"+contY);}else{input.name="radio2";input.id="radio2_"+contY;label.setAttribute("for","radio2_"+contY);} input.value=contY+1;label.innerHTML=conTenedor.innerHTML;div.appendChild(input);div.appendChild(label);div.appendChild(espacio1);div.appendChild(espacio2);contY++;} boxPos++;} if(i==6||i==7){question=xmlDoc.getElementsByTagName("title")[i].innerHTML;document.getElementsByTagName("h3")[i].innerHTML=question;if(i==6){xPath="/questions/question[@id='jklm_007']/option";}else{xPath="/questions/question[@id='jklm_008']/option";} nodo=xmlDoc.evaluate(xPath,xmlDoc,null,XPathResult.ANY_TYPE,null);var div=document.getElementsByTagName("div")[boxPos] contY=0;while(conTenedor=nodo.iterateNext()){var linea=document.createElement("label");var input=document.createElement("input");var separador1=document.createElement("br");var separador2=document.createElement("br");linea.innerHTML=conTenedor.innerHTML;input.type="checkbox";if(i==6){input.name="check1";input.id="check1_"+contY;linea.setAttribute("for","check1_"+contY);}else{input.name="check2";input.id="check2_"+contY;linea.setAttribute("for","check2_"+contY);} input.value=contY+1;div.appendChild(input);div.appendChild(linea);div.appendChild(separador1);div.appendChild(separador2);contY++;} boxPos++;} if(i==8||i==9){question=xmlDoc.getElementsByTagName("title")[i].innerHTML;document.getElementsByTagName("h3")[i].innerHTML=question;if(i==8){xPath="/questions/question[@id='jklm_009']/option";}else{xPath="/questions/question[@id='jklm_010']/option";} nodo=xmlDoc.evaluate(xPath,xmlDoc,null,XPathResult.ANY_TYPE,null);var select=document.getElementsByTagName("select")[selPos];contY=0;while(conTenedor=nodo.iterateNext()){var option=document.createElement("option");option.text=conTenedor.innerHTML;option.value=contY+1;select.options.add(option);contY++;} selPos++;}}} function corregirTipoText(){while(contQues<2){answerXml=xmlDoc.getElementsByTagName("question")[contQues].getElementsByTagName("answer")[0].innerHTML;answerUser=formElement.elements[contQues].value;answerUser=answerUser.toLowerCase();miNota();contQues++;}} function corregirTiposSelect(){while(contQues<4){answerXml=xmlDoc.getElementsByTagName("question")[contQues].getElementsByTagName("answer")[0].innerHTML;answerUser=formElement.elements[contQues].selectedIndex;answerUser=answerUser-1;miNota();contQues++;}} function corregirTiposRadio(){while(contQues<6){answerXml=xmlDoc.getElementsByTagName("question")[contQues].getElementsByTagName("answer")[0].innerHTML;answerXml=parseInt(answerXml);if(contQues==4){answerUser=-1;for(i=0;i<formElement.radio1.length;i++){if(formElement.radio1[i].checked){answerUser=i;i=formElement.radio1.length;}}}else{answerUser=-1;for(i=0;i<formElement.radio2.length;i++){if(formElement.radio2[i].checked){answerUser=i;i=formElement.radio2.length;}}} miNota();contQues++;}} function corregirTiposCheckbox(){while(contQues<8){answerXml=xmlDoc.getElementsByTagName("question")[contQues].getElementsByTagName("answer")[0].innerHTML;answerXml=parseInt(answerXml);var check=0;if(contQues==6){answerUser=-1;for(i=0;i<formElement.check1.length;i++){if(formElement.check1[i].checked){check++;}} if(check==1){for(i=0;i<formElement.check1.length;i++){if(formElement.check1[i].checked){answerUser=i;i=formElement.check1.length;}}}}else{answerUser=-1;for(i=0;i<formElement.check2.length;i++){if(formElement.check2[i].checked){check++;}} if(check==1){for(i=0;i<formElement.check2.length;i++){if(formElement.check2[i].checked){answerUser=i;i=formElement.check2.length;}}}} miNota();contQues++;}} function corregirTiposSelMultiple(){selPos=selPos-2;while(contQues<10){answerXml=xmlDoc.getElementsByTagName("question")[contQues].getElementsByTagName("answer")[0].innerHTML;answerXml+=xmlDoc.getElementsByTagName("question")[contQues].getElementsByTagName("answer")[1].innerHTML;answerUser="";if(contQues==8){numOpt=document.getElementsByTagName("select")[selPos].getElementsByTagName("option").length;for(i=0;i<numOpt;i++){var sel=document.getElementsByTagName("select")[selPos].getElementsByTagName("option")[i];if(sel.selected){answerUser+=i;}}}else{numOpt=document.getElementsByTagName("select")[selPos].getElementsByTagName("option").length;for(i=0;i<numOpt;i++){var sel=document.getElementsByTagName("select")[selPos].getElementsByTagName("option")[i];if(sel.selected){answerUser+=i;}}} miNota();contQues++;selPos++;}} function miNota(){if(answerUser==answerXml){nota+=1;}else{if(nota>=1){nota-=0.5;}else{nota=0;}}} function coprobarPreguntas(){var f=formElement;var radios1=true;var radios2=true;for(i=0;i<f.radio1.length;i++){if(f.radio1[i].checked){radios1=false;i=f.radio1.length;}} for(i=0;i<f.radio2.length;i++){if(f.radio2[i].checked){radios2=false;i=f.radio2.length;}} var checkeada1=true;var checkeada2=true;for(i=0;i<f.check1.length;i++){if(f.check1[i].checked){checkeada1=false;i=f.check1.length;}} for(i=0;i<f.check2.length;i++){if(f.check2[i].checked){checkeada2=false;i=f.check2.length;}} var multiple1=true;var multiple2=true;var num=document.getElementsByTagName("select")[2].getElementsByTagName("option").length;for(i=0;i<num;i++){var opt=document.getElementsByTagName("select")[2].getElementsByTagName("option")[i];if(opt.selected){multiple1=false;i=num;}} num=document.getElementsByTagName("select")[3].getElementsByTagName("option").length;for(i=0;i<num;i++){opt=document.getElementsByTagName("select")[3].getElementsByTagName("option")[i];if(opt.selected){multiple2=false;i=num;}} if(f.elements[0].value==""){f.elements[0].focus();alert("Porfavor, Responda todas las preguntas para corregir");return false;}else if(f.elements[1].value==""){f.elements[1].focus();alert("Porfavor, Responda todas las preguntas para corregir");return false;}else if(f.elements[2].selectedIndex==0){f.elements[2].focus();alert("Porfavor, Responda todas las preguntas para corregir");return false;}else if(f.elements[3].selectedIndex==0){f.elements[3].focus();alert("Porfavor, Responda todas las preguntas para corregir");return false;}else if(radios1){alert("No has respondido la pregunta 5, de tipo radio");return false;}else if(radios2){alert("No has respondido la pregunta 6, de tipo radio");return false;}else if(checkeada1){alert("No has respondido la pregunta 7, de tipo checkbox");return false;}else if(checkeada2){alert("No has respondido la pregunta 8, de tipo checkbox");return false;}else if(multiple1){alert("No has respondido la pregunta 9, de tipo multiple");return false;}else if(multiple2){alert("No has respondido la pregunta 10, de tipo multiple");return false;}else{return true;}} function mostrarNota(){if(nota<5){document.getElementById("nota").innerHTML="Ha suspendido: "+nota;}else{document.getElementById("nota").innerHTML="Ha aprobado: "+nota;} document.getElementById("sub").style.display="none";document.getElementById("refres").style.display="block";}
