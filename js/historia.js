function gestionarXml(a){xmlDoc=a.responseXML,leerYpintar()}function leerYpintar(){for(questions=10,i=0;i<questions;i++){if(0!=i&&1!=i||(question=xmlDoc.getElementsByTagName("title")[i].innerHTML,document.getElementsByTagName("h3")[i].innerHTML=question),2==i||3==i){question=xmlDoc.getElementsByTagName("title")[i].innerHTML,document.getElementsByTagName("h3")[i].innerHTML=question,xPath=2==i?"/questions/question[@id='jklm_003']/option":"/questions/question[@id='jklm_004']/option",nodo=xmlDoc.evaluate(xPath,xmlDoc,null,XPathResult.ANY_TYPE,null);var a=document.getElementsByTagName("select")[selPos];for(contY=0;conTenedor=nodo.iterateNext();){var b=document.createElement("option");b.text=conTenedor.innerHTML,b.value=contY+1,contY++,a.options.add(b)}selPos++}if(4==i||5==i){question=xmlDoc.getElementsByTagName("title")[i].innerHTML,document.getElementsByTagName("h3")[i].innerHTML=question,xPath=4==i?"/questions/question[@id='jklm_005']/option":"/questions/question[@id='jklm_006']/option",nodo=xmlDoc.evaluate(xPath,xmlDoc,null,XPathResult.ANY_TYPE,null);var c=document.getElementsByTagName("div")[boxPos];for(contY=0;conTenedor=nodo.iterateNext();){var d=document.createElement("input"),e=document.createElement("label"),f=document.createElement("br"),g=document.createElement("br");d.type="radio",4==i?(d.name="radio1",d.id="radio1_"+contY,e.setAttribute("for","radio1_"+contY)):(d.name="radio2",d.id="radio2_"+contY,e.setAttribute("for","radio2_"+contY)),d.value=contY+1,e.innerHTML=conTenedor.innerHTML,c.appendChild(d),c.appendChild(e),c.appendChild(f),c.appendChild(g),contY++}boxPos++}if(6==i||7==i){question=xmlDoc.getElementsByTagName("title")[i].innerHTML,document.getElementsByTagName("h3")[i].innerHTML=question,xPath=6==i?"/questions/question[@id='jklm_007']/option":"/questions/question[@id='jklm_008']/option",nodo=xmlDoc.evaluate(xPath,xmlDoc,null,XPathResult.ANY_TYPE,null);var c=document.getElementsByTagName("div")[boxPos];for(contY=0;conTenedor=nodo.iterateNext();){var h=document.createElement("label"),d=document.createElement("input"),j=document.createElement("br"),k=document.createElement("br");h.innerHTML=conTenedor.innerHTML,d.type="checkbox",6==i?(d.name="check1",d.id="check1_"+contY,h.setAttribute("for","check1_"+contY)):(d.name="check2",d.id="check2_"+contY,h.setAttribute("for","check2_"+contY)),d.value=contY+1,c.appendChild(d),c.appendChild(h),c.appendChild(j),c.appendChild(k),contY++}boxPos++}if(8==i||9==i){question=xmlDoc.getElementsByTagName("title")[i].innerHTML,document.getElementsByTagName("h3")[i].innerHTML=question,xPath=8==i?"/questions/question[@id='jklm_009']/option":"/questions/question[@id='jklm_010']/option",nodo=xmlDoc.evaluate(xPath,xmlDoc,null,XPathResult.ANY_TYPE,null);var a=document.getElementsByTagName("select")[selPos];for(contY=0;conTenedor=nodo.iterateNext();){var b=document.createElement("option");b.text=conTenedor.innerHTML,b.value=contY+1,a.options.add(b),contY++}selPos++}}}function corregirTipoText(){for(;contQues<2;)answerXml=xmlDoc.getElementsByTagName("question")[contQues].getElementsByTagName("answer")[0].innerHTML,answerUser=formElement.elements[contQues].value,answerUser=answerUser.toLowerCase(),miNota(),contQues++}function corregirTiposSelect(){for(;contQues<4;)answerXml=xmlDoc.getElementsByTagName("question")[contQues].getElementsByTagName("answer")[0].innerHTML,answerUser=formElement.elements[contQues].selectedIndex,answerUser-=1,miNota(),contQues++}function corregirTiposRadio(){for(;contQues<6;){if(answerXml=xmlDoc.getElementsByTagName("question")[contQues].getElementsByTagName("answer")[0].innerHTML,answerXml=parseInt(answerXml),4==contQues)for(answerUser=-1,i=0;i<formElement.radio1.length;i++)formElement.radio1[i].checked&&(answerUser=i,i=formElement.radio1.length);else for(answerUser=-1,i=0;i<formElement.radio2.length;i++)formElement.radio2[i].checked&&(answerUser=i,i=formElement.radio2.length);miNota(),contQues++}}function corregirTiposCheckbox(){for(;contQues<8;){answerXml=xmlDoc.getElementsByTagName("question")[contQues].getElementsByTagName("answer")[0].innerHTML,answerXml=parseInt(answerXml);var a=0;if(6==contQues){for(answerUser=-1,i=0;i<formElement.check1.length;i++)formElement.check1[i].checked&&a++;if(1==a)for(i=0;i<formElement.check1.length;i++)formElement.check1[i].checked&&(answerUser=i,i=formElement.check1.length)}else{for(answerUser=-1,i=0;i<formElement.check2.length;i++)formElement.check2[i].checked&&a++;if(1==a)for(i=0;i<formElement.check2.length;i++)formElement.check2[i].checked&&(answerUser=i,i=formElement.check2.length)}miNota(),contQues++}}function corregirTiposSelMultiple(){for(selPos-=2;contQues<10;){if(answerXml=xmlDoc.getElementsByTagName("question")[contQues].getElementsByTagName("answer")[0].innerHTML,answerXml+=xmlDoc.getElementsByTagName("question")[contQues].getElementsByTagName("answer")[1].innerHTML,answerUser="",8==contQues)for(numOpt=document.getElementsByTagName("select")[selPos].getElementsByTagName("option").length,i=0;i<numOpt;i++){var a=document.getElementsByTagName("select")[selPos].getElementsByTagName("option")[i];a.selected&&(answerUser+=i)}else for(numOpt=document.getElementsByTagName("select")[selPos].getElementsByTagName("option").length,i=0;i<numOpt;i++){var a=document.getElementsByTagName("select")[selPos].getElementsByTagName("option")[i];a.selected&&(answerUser+=i)}miNota(),contQues++,selPos++}}function miNota(){answerUser==answerXml?nota+=1:nota>=1?nota-=.5:nota=0}function coprobarPreguntas(){var a=formElement,b=!0,c=!0;for(i=0;i<a.radio1.length;i++)a.radio1[i].checked&&(b=!1,i=a.radio1.length);for(i=0;i<a.radio2.length;i++)a.radio2[i].checked&&(c=!1,i=a.radio2.length);var d=!0,e=!0;for(i=0;i<a.check1.length;i++)a.check1[i].checked&&(d=!1,i=a.check1.length);for(i=0;i<a.check2.length;i++)a.check2[i].checked&&(e=!1,i=a.check2.length);var f=!0,g=!0,h=document.getElementsByTagName("select")[2].getElementsByTagName("option").length;for(i=0;i<h;i++){var j=document.getElementsByTagName("select")[2].getElementsByTagName("option")[i];j.selected&&(f=!1,i=h)}for(h=document.getElementsByTagName("select")[3].getElementsByTagName("option").length,i=0;i<h;i++)j=document.getElementsByTagName("select")[3].getElementsByTagName("option")[i],j.selected&&(g=!1,i=h);return""==a.elements[0].value?(a.elements[0].focus(),alert("Porfavor, Responda todas las preguntas para corregir"),!1):""==a.elements[1].value?(a.elements[1].focus(),alert("Porfavor, Responda todas las preguntas para corregir"),!1):0==a.elements[2].selectedIndex?(a.elements[2].focus(),alert("Porfavor, Responda todas las preguntas para corregir"),!1):0==a.elements[3].selectedIndex?(a.elements[3].focus(),alert("Porfavor, Responda todas las preguntas para corregir"),!1):b?(alert("No has respondido la pregunta 5, de tipo radio"),!1):c?(alert("No has respondido la pregunta 6, de tipo radio"),!1):d?(alert("No has respondido la pregunta 7, de tipo checkbox"),!1):e?(alert("No has respondido la pregunta 8, de tipo checkbox"),!1):f?(alert("No has respondido la pregunta 9, de tipo multiple"),!1):g?(alert("No has respondido la pregunta 10, de tipo multiple"),!1):(mostrar=!0,!0)}function mostrarNota(){nota<5?document.getElementById("nota").innerHTML="Ha suspendido: "+nota:document.getElementById("nota").innerHTML="Ha aprobado: "+nota,document.getElementById("sub").style.display="none",document.getElementById("refres").style.display="block"}var formElement=null,xmlDoc=null,question,questions=0,numOpt=0,opcionesArray=[],intI=0,selPos=0,boxPos=0,nota=0,contQues=0,answerXml=null,answerUser=null,xPath="",nodo=null,conTenedor=null,contY=0,mostrar=!1;window.onload=function(){formElement=document.getElementById("myform"),formElement.onsubmit=function(){return coprobarPreguntas()&&(corregirTipoText(),corregirTiposSelect(),corregirTiposRadio(),corregirTiposCheckbox(),corregirTiposSelMultiple(),mostrarNota()),!1};var a=new XMLHttpRequest;a.onreadystatechange=function(){4==this.readyState&&200==this.status&&gestionarXml(this)},a.open("GET","http://localhost/historia/xml/historia.xml",!0),a.send(),document.getElementById("refres").onclick=function(){formElement.reset(),location.reload(),document.getElementById("refres").style.display="none",document.getElementById("sub").style.display="block"}};
